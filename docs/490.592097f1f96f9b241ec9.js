"use strict";(self.webpackChunktodo_app_react=self.webpackChunktodo_app_react||[]).push([[490],{490:(e,t,a)=>{a.r(t),a.d(t,{default:()=>w});var r=a(540),o=a(643);const n=(0,r.createContext)(),s=(0,r.createContext)(),c=function(e){return r.createElement("div",{className:"app-container"},e.children)},i=function(e){return(0,r.useEffect)((()=>{document.title=`Todo app | ${e.title}`}),[e.title]),r.createElement(c,null,e.children)},l=function(e){return r.createElement("div",{className:"hero "+(e.bgImage?"":"no-bg")},r.createElement("img",{src:`https://imd94.github.io/todo-app-react/assets/images/bg-desktop-${e.darkMode?"dark":"light"}.jpg`,alt:"Hero Image"}))},d=function(){const e=(0,r.useContext)(n),t=(0,r.useContext)(s);return r.createElement("header",{className:"todo-header"},r.createElement("h1",{className:"todo-header__title"},"Todo"),r.createElement("button",{onClick:function(t){t.preventDefault(),e({type:"darkModeActive"})},className:"light-switch "+(t.darkMode?"dark-mode":"")},r.createElement("span",{className:"light-switch__text"},"Light switch")))};var u=a(83),m=a(306);const p=function(){const e=(0,r.useContext)(m.A),t=(0,r.useContext)(n),a=(0,r.useRef)(),[s,c]=(0,o.A)((function(e,t){switch(t.type){case"descriptionChange":return e.description.hasErrors=!1,void(e.description.value=t.value);case"descriptionRules":return t.value.trim()||(e.description.hasErrors=!0,e.description.errMessage="You must provide an item content!"),void(t.value.length>50&&(e.description.hasErrors=!0,e.description.errMessage="Item description cannot exceed 50 characters!"));case"saveRequestStarted":return void(e.isSaving=!0);case"saveRequestFinished":return e.isSaving=!1,e.description.value="",void a.current.focus();case"submitRequest":return void(e.description.hasErrors||e.sendCount++)}}),{description:{value:"",completed:0,hasErrors:!1,errMessage:""},isSaving:!1,sendCount:0});return(0,r.useEffect)((()=>{if(s.sendCount){c({type:"saveRequestStarted"});const a=u.A.CancelToken.source();async function r(){try{const r=await u.A.post("/create-item",{item_description:s.description.value,completed:s.description.completed},{cancelToken:a.token});c({type:"saveRequestFinished"}),r.data?(t({type:"newItemCreated",value:s.sendCount}),e({type:"flashMessage",value:"New item was successfuly added!",class:"success"})):e({type:"flashMessage",value:"Sorry, we did not get to add new item!",class:"danger"})}catch(e){console.log("Sorry, there was a problem!")}}return r(),()=>{a.cancel()}}}),[s.sendCount]),r.createElement("form",{onSubmit:function(e){e.preventDefault(),c({type:"descriptionRules",value:s.description.value}),c({type:"submitRequest"})},className:"todo-create-item",id:"create-form"},r.createElement("div",{className:`flash-error ${s.description.hasErrors&&"active"}`},s.description.hasErrors&&r.createElement("p",{className:"flash-error__message"},s.description.errMessage)),r.createElement("div",{className:"todo-item todo-item--create"},r.createElement("input",{onChange:e=>c({type:"descriptionChange",value:e.target.value}),value:s.description.value,ref:a,id:"create-field",name:"item_description",autoFocus:!0,autoComplete:"off",className:"create-field",type:"text",placeholder:"Create a new todo..."}),r.createElement("button",{className:"check-btn__wrapper"},r.createElement("span",{className:"check-btn"},r.createElement("span",{className:"hidden"},"Add New Item")))))},g=function(e){const t=(0,r.useContext)(m.A),a=(0,r.useContext)(n),s=(0,r.useRef)(),c=(0,r.useRef)(),i=(0,r.useRef)(),l=(0,r.useRef)(),d=(0,r.useRef)();let p=!1;const g={item:{value:e.item.description,completed:e.item.completed,id:e.item.id,hasErrors:!1,errorMessages:[],width:"",widthChangeCounter:0,focus:!1},descriptionChanged:!1,descriptionUpdateCounter:0,completedCounter:0,deleteCounter:0},[h,C]=(0,o.A)((function(e,t){switch(t.type){case"descriptionChanged":return e.item.hasErrors=!1,e.item.errorMessages=[],e.item.value=t.value,void(e.descriptionChanged=!0);case"descriptionUpdate":return t.value.trim()||(e.item.hasErrors=!0,e.item.errorMessages.push("You must provide an item content!")),t.value.length>50&&(e.item.hasErrors=!0,e.item.errorMessages.push("Item description cannot exceed 50 characters!")),void(!e.item.errorMessages.length&&e.descriptionChanged&&(e.descriptionUpdateCounter++,e.descriptionChanged=!1));case"itemStatus":return e.completedCounter++,void(t.value?e.item.completed=0:e.item.completed=1);case"itemDeleteStatus":return void e.deleteCounter++;case"saveItemWidth":return void(e.item.width=t.value);case"itemWidthChanged":return void e.item.widthChangeCounter++;case"itemOnFocus":return void(e.item.focus=!0)}}),g);function f(){let e="";return h.item.completed&&(e="completed"),e}return(0,r.useEffect)((()=>{if(h.descriptionUpdateCounter){const e=u.A.CancelToken.source();async function a(){try{"success"===(await u.A.post("/update-item",{item_description:h.item.value,completed:h.item.completed,id:h.item.id},{cancelToken:e.token})).data?t({type:"flashMessage",value:"Item was successfully updated!",class:"success"}):t({type:"flashMessage",value:"Sorry, we couldn't update selected item!",class:"danger"})}catch(e){console.log("Sorry, there was a problem!")}}return a(),()=>{e.cancel()}}}),[h.descriptionUpdateCounter]),(0,r.useEffect)((()=>{if(h.completedCounter){const e=u.A.CancelToken.source();async function t(){try{await u.A.post("/update-item-status",{id:h.item.id,completed:h.item.completed},{cancelToken:e.token}),a({type:"statusUpdated"})}catch(e){console.log("Sorry, there was a problem!")}}return t(),()=>{e.cancel()}}}),[h.completedCounter]),(0,r.useEffect)((()=>{if(h.deleteCounter){const e=u.A.CancelToken.source();async function r(){if(confirm("Are you sure you want to delete this todo item?"))try{const r=await u.A.post("/delete-item",{id:h.item.id},{cancelToken:e.token});r.data?(a({type:"itemDeleted",value:h.deleteCounter}),t({type:"flashMessage",value:r.data,class:"success"})):t({type:"flashMessage",value:"Sorry, we did not get to delete this item!",class:"danger"})}catch(e){console.log("Sorry, there was a problem!")}}return r(),()=>{e.cancel()}}}),[h.deleteCounter]),(0,r.useEffect)((()=>{C({type:"saveItemWidth",value:i.current.offsetWidth})}),[h.item.widthChangeCounter]),r.createElement("li",{"data-id":h.item.id,className:`todo-item ${f()} ${h.item.hasErrors?"has-error":""}`,ref:d,"data-completed":h.item.completed,onClick:function(e){p?p=!1:e.target===d.current&&(e.stopPropagation(),p=!0,l.current.focus())},style:{"--input-width":h.item.width+10+"px"}},r.createElement("input",{type:"text",name:"item_description",id:"todo-item-item_description-"+h.item.id,className:"todo-item__text-input",ref:l,autoComplete:"off",value:h.item.value,onChange:e=>C({type:"descriptionChanged",value:e.target.value}),onBlur:e=>C({type:"descriptionUpdate",value:e.target.value}),onInput:function(e){i.current.textContent=e.target.value,e.target.style.width=`${i.current.offsetWidth+10}px`,C({type:"itemWidthChanged"})}}),r.createElement("span",{className:"hidden-input-content",ref:i},h.item.value),r.createElement("div",{className:"check-btn__wrapper",onClick:function(e){p?p=!1:(e.target!==s.current&&(e.stopPropagation(),p=!0,s.current.click()),C({type:"itemStatus",value:h.item.completed}))},ref:s},r.createElement("button",{className:`check-btn ${f()}`},r.createElement("img",{className:"check-btn__icon",src:"https://imd94.github.io/todo-app-react/assets/images/icon-check.svg",alt:"Check Icon"}))),r.createElement("div",{className:"todo-item-cta"},r.createElement("button",{className:"action-button delete-me",onClick:function(e){p?p=!1:(e.target!==c.current&&(e.stopPropagation(),p=!0,c.current.click()),C({type:"itemDeleteStatus"}))},ref:c},r.createElement("span",{className:"hidden"},"Delete"),r.createElement("img",{className:"action-button__icon",src:"https://imd94.github.io/todo-app-react/assets/images/icon-cross.svg",alt:"Delete Icon"}))),h.item.hasErrors&&r.createElement("div",{className:`field-messages ${h.item.hasErrors&&"active"}`},h.item.errorMessages.map(((e,t)=>r.createElement("div",{className:"field-error-message",key:`${e}-${t}`},r.createElement("p",{className:"field-error-message__description"},e))))))},h=function(e){const t=(0,r.useContext)(m.A),a=(0,r.useContext)(n),[o,s]=(0,r.useState)(0),[c,i]=(0,r.useState)(0),[l,d]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{const e=document.querySelectorAll(".todo-list .todo-item");if(e){const t=Array.from(e).filter((e=>"1"===e.getAttribute("data-completed")));g(t.length)}}),[e.itemStatus.statusCompleted]),(0,r.useEffect)((()=>{if(o){const e=u.A.CancelToken.source();async function r(){if(p)try{if(window.confirm("Do you really want to delete completed items!")){const r=await u.A.post("/delete-completed-items",{cancelToken:e.token});r.data?(a({type:"deleteCompletedItems",value:o}),t({type:"flashMessage",value:r.data,class:"success"})):t({type:"flashMessage",value:"Sorry, we did not succeed to delete completed items!",class:"danger"})}}catch(e){console.log("Sorry, there was a problem!")}else t({type:"flashMessage",value:"Sorry, there are no completed items to delete!",class:"danger"})}return r(),()=>{e.cancel()}}}),[o]),(0,r.useEffect)((()=>{const e=u.A.CancelToken.source();return d(!0),async function(){try{const t=await u.A.get("/active-items-count",{cancelToken:e.token});i(t.data),d(!1)}catch(e){d(!1),console.log("Sorry, there was a problem!")}}(),()=>{e.cancel()}}),[e.itemStatus.newItemCreationCounter,e.itemStatus.deleteItemCounter,e.itemStatus.itemsCompletedStatus,e.itemStatus.statusCompleted]),r.createElement("div",{className:"list-footer"},r.createElement("span",{className:"items-count list-footer__items-left"},l?"Calculating...":`${c} items left`),r.createElement("span",{className:"clear-completed-btn list-footer__clear-btn",onClick:function(){s(o+1)}},"Clear Completed"))};var C=a(498);const f=function(e){const[t,a]=(0,o.A)((function(e,t){switch(t.type){case"fetchingStart":return e.notFound=!1,void(e.isLoading=!0);case"fetchingComplete":return e.notFound=!1,e.isFetching=!1,e.isLoading=!1,void(e.items=t.value);case"notFound":return e.isFetching=!1,void(e.notFound=!0)}}),{items:[],isFetching:!0,isLoading:!1,notFound:!1});return(0,r.useEffect)((()=>{const t=u.A.CancelToken.source();return a({type:"fetchingStart"}),async function(){try{const r=await u.A.post("/items",{category:e.category},{cancelToken:t.token});r.data?a({type:"fetchingComplete",value:r.data}):a({type:"notFound"})}catch(e){console.log("Sorry, there was a problem!",e)}}(),()=>{t.cancel()}}),[e.newItemCreationCounter,e.deleteItemCounter,e.categoryTriggerCount,e.itemsCompletedStatus]),t.isFetching?r.createElement(C.A,null):t.notFound?r.createElement("div",{className:"not-found"},r.createElement("p",{className:"not-found__text"},"category--all"===e.category&&"Currently there are no created items!",("category--active"===e.category||"category--completed"===e.category)&&`Currently there are no ${e.category.toLowerCase().replace("category--","")} items!`)):r.createElement("div",{className:"item-list-wrapper__inner "+(t.isLoading||t.isFetching?"loading-state":"")},t.isLoading&&r.createElement(C.A,null),!t.isLoading&&r.createElement("ul",{id:"item-list",className:"todo-list"},t.items.map((e=>r.createElement(g,{item:e,key:e.id})))),r.createElement(h,{incomplete:t.incompletedItemsCount,itemStatus:{newItemCreationCounter:e.newItemCreationCounter,deleteItemCounter:e.deleteItemCounter,itemsCompletedStatus:e.itemsCompletedStatus,statusCompleted:e.statusCompleted}}))},v=function(){return r.createElement("div",{className:"attribution"},"Challenge by ",r.createElement("a",{href:"https://www.frontendmentor.io?ref=challenge",target:"_blank"},"Frontend Mentor"),". Coded by ",r.createElement("a",{href:"#"},"Ivan Mirkovic"),".")},y=function(){return r.createElement("p",{className:"note"},"Drag and drop to reorder list.")},E=function(e){const t=(0,r.useContext)(s),a=(0,r.useContext)(n);function o(e){let t=e.target;t.classList.contains("category--active")?a({type:"categoryTriggered",value:"category--active"}):t.classList.contains("category--completed")?a({type:"categoryTriggered",value:"category--completed"}):a({type:"categoryTriggered",value:"category--all"})}return r.createElement("div",{className:"item-categories"},r.createElement("span",{onClick:o,className:"category category--all "+("category--all"===t.currentCategory?"current":"")},"All"),r.createElement("span",{onClick:o,className:"category category--active "+("category--active"===t.currentCategory?"current":"")},"Active"),r.createElement("span",{onClick:o,className:"category category--completed "+("category--completed"===t.currentCategory?"current":"")},"Completed"))},w=function(){const e={newItemCreationCounter:0,deleteItemCounter:0,itemsCompletedStatus:0,statusCompleted:0,darkMode:Boolean(localStorage.getItem("theme-mode")),currentCategory:"category--all",categoryTriggerCount:0},[t,a]=(0,o.A)((function(e,t){switch(t.type){case"newItemCreated":return void(e.newItemCreationCounter=t.value);case"itemDeleted":return void(e.deleteItemCounter=t.value);case"deleteCompletedItems":return void(e.itemsCompletedStatus=t.value);case"statusUpdated":return void e.statusCompleted++;case"categoryTriggered":return e.currentCategory=t.value,void e.categoryTriggerCount++;case"darkModeActive":return void(e.darkMode?e.darkMode=!1:e.darkMode=!0)}}),e);return(0,r.useEffect)((()=>{t.darkMode?localStorage.setItem("theme-mode","dark-mode"):localStorage.removeItem("theme-mode")}),[t.darkMode]),r.createElement(s.Provider,{value:t},r.createElement(n.Provider,{value:a},r.createElement(l,{darkMode:t.darkMode,bgImage:!0}),r.createElement(i,{title:"Home"},r.createElement(d,null),r.createElement(p,null),r.createElement("div",{className:"item-list-wrapper"},r.createElement(f,{newItemCreationCounter:t.newItemCreationCounter,deleteItemCounter:t.deleteItemCounter,itemsCompletedStatus:t.itemsCompletedStatus,statusCompleted:t.statusCompleted,category:t.currentCategory,categoryTriggerCount:t.categoryTriggerCount}),r.createElement(E,null)),r.createElement(y,null)),r.createElement(v,null)))}}}]);